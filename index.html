<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>크루즈링크 - 프리미엄 크루즈 여행</title>
  <meta name="description" content="MSC, NCL 크루즈 전문 - 지중해, 알래스카, 카리브해, 일본 크루즈 여행 상담">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🚢</text></svg>">
</head>
<body>
  <div id="header"></div>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-overlay"></div>
    <div class="container hero-content">
      <span class="hero-badge">🚢 MSC · Norwegian Cruise Line</span>
      <h1>바다 위의 특별한 여행,<br>크루즈링크에서 시작하세요</h1>
      <p class="hero-sub">지중해의 석양부터 알래스카의 빙하까지 — 전 세계 크루즈를 한곳에서</p>
    </div>
  </section>

  <!-- FILTER BAR -->
  <div class="container">
    <div class="filter-bar">
      <div class="filter-group">
        <label>목적지</label>
        <select id="filterDest" onchange="updateDepartureOptions()">
          <option value="">전체</option>
          <option value="korea">한국/일본</option>
          <option value="mediterranean">지중해</option>
          <option value="alaska">알래스카</option>
          <option value="caribbean">카리브해</option>
          <option value="northern-europe">북유럽</option>
          <option value="asia">아시아/중동</option>
          <option value="south-america">남미</option>
          <option value="oceania">오세아니아</option>
          <option value="hawaii">하와이</option>
        </select>
      </div>
      <div class="filter-group">
        <label>출발도시</label>
        <div class="multi-select" id="msPort" onclick="toggleMulti(this)">
          <div class="multi-select-display">전체</div>
          <div class="multi-select-dropdown" id="msPortDropdown"></div>
        </div>
      </div>
      <div class="filter-group">
        <label>선사</label>
        <div class="multi-select" id="msOperator" onclick="toggleMulti(this)">
          <div class="multi-select-display">전체</div>
          <div class="multi-select-dropdown">
            <div class="ms-option" data-value="MSC" onclick="toggleOption(event, this)">MSC 크루즈</div>
            <div class="ms-option" data-value="Norwegian" onclick="toggleOption(event, this)">노르웨이전 크루즈 라인</div>
          </div>
        </div>
      </div>
      <div class="filter-group">
        <label>출발월</label>
        <select id="filterMonth">
          <option value="">전체</option>
        </select>
      </div>
      <div class="filter-group">
        <label>기간</label>
        <select id="filterDuration">
          <option value="">전체</option>
          <option value="short">1~5박</option>
          <option value="medium">6~10박</option>
          <option value="long">11박 이상</option>
        </select>
      </div>
      <button class="btn btn-orange" onclick="doSearch()">🔍 검색</button>
    </div>
  </div>

  <!-- DESTINATIONS -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">인기 목적지</h2>
      <p class="section-subtitle">전 세계 크루즈 목적지를 탐험하세요</p>
      <div class="dest-grid">
        <a href="destination.html?dest=korea" class="dest-card"><span class="emoji">🇰🇷</span><span class="name">한국/일본</span></a>
        <a href="destination.html?dest=mediterranean" class="dest-card"><span class="emoji">🏛️</span><span class="name">지중해</span></a>
        <a href="destination.html?dest=alaska" class="dest-card"><span class="emoji">🏔️</span><span class="name">알래스카</span></a>
        <a href="destination.html?dest=caribbean" class="dest-card"><span class="emoji">🏝️</span><span class="name">카리브해</span></a>
        <a href="destination.html?dest=northern-europe" class="dest-card"><span class="emoji">⚓</span><span class="name">북유럽</span></a>
        <a href="destination.html?dest=asia" class="dest-card"><span class="emoji">🕌</span><span class="name">아시아/중동</span></a>
        <a href="destination.html?dest=south-america" class="dest-card"><span class="emoji">🌎</span><span class="name">남미</span></a>
        <a href="destination.html?dest=oceania" class="dest-card"><span class="emoji">🦘</span><span class="name">오세아니아</span></a>
        <a href="destination.html?dest=hawaii" class="dest-card"><span class="emoji">🌴</span><span class="name">하와이</span></a>
      </div>
    </div>
  </section>

  <!-- PROMO SLIDER -->
  <section class="section" style="background: var(--gray-50);">
    <div class="container">
      <div class="promo-slider">
        <div class="promo-slides" id="promoSlides">
          <div class="promo-slide" style="background: url('https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=1200&q=80') center/cover;">
            <h3>🌊 2026 지중해 크루즈</h3>
            <p>바르셀로나, 로마, 산토리니... 지중해의 보석같은 도시들을 만나보세요</p>
            <a href="destination.html?dest=mediterranean" class="btn btn-orange" style="width:fit-content">지중해 크루즈 보기 →</a>
          </div>
          <div class="promo-slide" style="background: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1200&q=80') center/cover;">
            <h3>❄️ 알래스카 빙하 크루즈</h3>
            <p>장엄한 빙하와 야생 동물, 대자연의 경이로움을 경험하세요</p>
            <a href="destination.html?dest=alaska" class="btn btn-orange" style="width:fit-content">알래스카 크루즈 보기 →</a>
          </div>
          <div class="promo-slide" style="background: url('https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=1200&q=80') center/cover;">
            <h3>🎌 한국/일본 출발 크루즈</h3>
            <p>부산, 후쿠오카, 나가사키, 오키나와 — 가까운 크루즈 여행</p>
            <a href="destination.html?dest=korea" class="btn btn-white" style="width:fit-content">아시아 크루즈 보기 →</a>
          </div>
        </div>
      </div>
      <div class="promo-dots" id="promoDots"></div>
    </div>
  </section>

  <!-- RECOMMENDED CRUISES -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">추천 크루즈</h2>
      <p class="section-subtitle">가까운 출발일 기준 엄선된 크루즈</p>
      <div id="recommendedCruises" class="cruise-grid">
        <div class="loading"><div class="loading-spinner"></div><p>크루즈 정보를 불러오는 중...</p></div>
      </div>
    </div>
  </section>

  <!-- SEARCH RESULTS (hidden by default) -->
  <section class="section" id="searchResults" style="display:none; background: var(--gray-50);">
    <div class="container">
      <h2 class="section-title">검색 결과</h2>
      <p class="section-subtitle" id="searchCount"></p>
      <div id="searchList" class="cruise-list"></div>
    </div>
  </section>

  <div id="ctaSection"></div>
  <div id="footer"></div>

  <script src="assets/data/translations.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/components.js"></script>
  <script>
    document.getElementById('header').innerHTML = Components.header('home');
    document.getElementById('footer').innerHTML = Components.footer();
    document.getElementById('ctaSection').innerHTML = Components.ctaSection();

    // === Departure port mapping per destination ===
    const DEST_PORTS = {
      'korea': ['도쿄','나하, 오키나와','부산','인천'],
      'mediterranean': ['바르셀로나','마르세유','제노바','치비타베키아','나폴리','팔레르모','발레타','메시나','리보르노','트리에스테','피레우스','이스탄불','리스본','말라가','발렌시아'],
      'alaska': ['시애틀','밴쿠버'],
      'caribbean': ['마이애미','포트 카나베럴','갤버스턴','뉴욕','뉴올리언스','산후안','잭슨빌','보스턴','탬파'],
      'northern-europe': ['사우샘프턴','코펜하겐','킬','헬싱키','레이캬비크','함부르크'],
      'asia': ['아부다비','두바이','도하','싱가포르'],
      'south-america': ['산투스','살바도르','부에노스아이레스','리우데자네이루','로스앤젤레스','마이애미'],
      'oceania': ['시드니','오클랜드','멜버른','브리즈번'],
      'hawaii': ['호놀룰루, 하와이'],
    };

    // === Multi-select functions ===
    function toggleMulti(el) {
      // Close other open multi-selects
      document.querySelectorAll('.multi-select.open').forEach(ms => { if (ms !== el) ms.classList.remove('open'); });
      el.classList.toggle('open');
    }
    function toggleOption(e, optEl) {
      e.stopPropagation();
      optEl.classList.toggle('selected');
      updateMultiDisplay(optEl.closest('.multi-select'));
    }
    function updateMultiDisplay(msEl) {
      const selected = [...msEl.querySelectorAll('.ms-option.selected')];
      const display = msEl.querySelector('.multi-select-display');
      display.textContent = selected.length === 0 ? '전체' : selected.map(o => o.textContent).join(', ');
    }
    function getMultiValues(msEl) {
      return [...msEl.querySelectorAll('.ms-option.selected')].map(o => o.dataset.value);
    }
    // Close multi-select on outside click
    document.addEventListener('click', e => {
      if (!e.target.closest('.multi-select')) {
        document.querySelectorAll('.multi-select.open').forEach(ms => ms.classList.remove('open'));
      }
    });

    function updateDepartureOptions() {
      const dest = document.getElementById('filterDest').value;
      const dropdown = document.getElementById('msPortDropdown');
      const msPort = document.getElementById('msPort');
      // Reset
      dropdown.innerHTML = '';
      msPort.querySelector('.multi-select-display').textContent = '전체';
      if (!dest || !DEST_PORTS[dest]) return;
      DEST_PORTS[dest].forEach(port => {
        dropdown.innerHTML += `<div class="ms-option" data-value="${port}" onclick="toggleOption(event, this)">${port}</div>`;
      });
    }

    // Populate month filter
    const monthSelect = document.getElementById('filterMonth');
    const now = new Date();
    for (let i = 0; i < 24; i++) {
      const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
      const val = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
      const label = `${d.getFullYear()}년 ${d.getMonth() + 1}월`;
      monthSelect.innerHTML += `<option value="${val}">${label}</option>`;
    }

    // Promo slider
    let promoIdx = 0;
    const slides = document.getElementById('promoSlides');
    const dotsContainer = document.getElementById('promoDots');
    for (let i = 0; i < 3; i++) {
      const dot = document.createElement('button');
      dot.className = 'promo-dot' + (i === 0 ? ' active' : '');
      dot.onclick = () => { promoIdx = i; updatePromo(); };
      dotsContainer.appendChild(dot);
    }
    function updatePromo() {
      slides.style.transform = `translateX(-${promoIdx * 100}%)`;
      dotsContainer.querySelectorAll('.promo-dot').forEach((d, i) => d.classList.toggle('active', i === promoIdx));
    }
    setInterval(() => { promoIdx = (promoIdx + 1) % 3; updatePromo(); }, 5000);

    // Load recommended cruises from LOCAL JSON
    async function loadRecommended() {
      const container = document.getElementById('recommendedCruises');
      try {
        const cruises = await API.getRecommendedCruises(9);
        if (cruises.length === 0) {
          container.innerHTML = '<div class="empty-state"><span class="emoji">🔍</span><p>표시할 크루즈가 없습니다</p></div>';
          return;
        }
        container.innerHTML = cruises.map(c => Components.localCruiseCard(c)).join('');
      } catch (e) {
        console.error(e);
        container.innerHTML = '<div class="empty-state"><span class="emoji">⚠️</span><p>데이터를 불러올 수 없습니다</p></div>';
      }
    }

    // Search from LOCAL JSON
    async function doSearch() {
      const dest = document.getElementById('filterDest').value;
      const operators = getMultiValues(document.getElementById('msOperator'));
      const ports = getMultiValues(document.getElementById('msPort'));
      const month = document.getElementById('filterMonth').value;
      const dur = document.getElementById('filterDuration').value;

      const resultsSection = document.getElementById('searchResults');
      const searchList = document.getElementById('searchList');
      const searchCount = document.getElementById('searchCount');
      resultsSection.style.display = 'block';
      searchList.innerHTML = Components.loading();

      try {
        const results = await API.filterCruises({ dest, operators, ports, month, duration: dur, limit: 100 });
        searchCount.textContent = `${results.length}개의 크루즈를 찾았습니다`;
        searchList.innerHTML = results.length
          ? results.map(c => Components.localCruiseItem(c)).join('')
          : '<div class="empty-state"><span class="emoji">🔍</span><p>조건에 맞는 크루즈가 없습니다</p></div>';
        resultsSection.scrollIntoView({ behavior: 'smooth' });
      } catch (e) {
        searchList.innerHTML = '<div class="empty-state"><span class="emoji">⚠️</span><p>검색 중 오류가 발생했습니다</p></div>';
      }
    }

    loadRecommended();

    /* ── Inquiry Modal ── */
    function openInquiry() {
      document.getElementById('inquiryModal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function closeInquiry() {
      document.getElementById('inquiryModal').classList.remove('open');
      document.body.style.overflow = '';
    }
    document.addEventListener('click', e => { if (e.target.id === 'inquiryModal') closeInquiry(); });
    function submitInquiry(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      btn.disabled = true; btn.textContent = '전송 중...';
      setTimeout(() => {
        document.getElementById('formStatus').innerHTML = '<div style="background:#e8f5e9;padding:16px;border-radius:8px;color:#2e7d32;margin-bottom:16px">✅ 문의가 접수되었습니다. 빠른 시일 내에 연락드리겠습니다.</div>';
        document.getElementById('inquiryForm').style.display = 'none';
        btn.style.display = 'none';
      }, 800);
    }
  </script>

  <!-- Inquiry Modal -->
  <div class="modal-overlay" id="inquiryModal">
    <div class="modal">
      <div class="modal-header">
        <h2>🚢 크루즈 문의하기</h2>
        <button class="modal-close" onclick="closeInquiry()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-status" id="formStatus"></div>
        <form id="inquiryForm" onsubmit="submitInquiry(event)">
          <div class="form-group">
            <label>영문 이름 (여권 기재명) <span class="req">*</span></label>
            <input type="text" id="f_name" name="customer_name" required placeholder="HONG GILDONG">
          </div>
          <div class="form-group">
            <label>이메일 <span class="req">*</span></label>
            <input type="email" id="f_email" name="customer_email" required placeholder="example@email.com">
          </div>
          <div class="form-group">
            <label>연락처 <span class="req">*</span></label>
            <input type="tel" id="f_phone" name="customer_phone" required placeholder="010-1234-5678">
          </div>
          <div class="form-group">
            <label>관심 크루즈 / 요청사항 <span class="req">*</span></label>
            <textarea id="f_message" name="message" rows="3" required placeholder="관심 있는 크루즈나 여행 일정을 알려주세요."></textarea>
          </div>
          <div class="privacy-section">
            <div class="privacy-check">
              <input type="checkbox" id="privacyAgree" required>
              <label for="privacyAgree">개인정보 수집·이용에 동의합니다. (필수)</label>
            </div>
            <button type="button" class="privacy-toggle" onclick="document.getElementById('privacyDetail').classList.toggle('open')">약관 보기 ▼</button>
            <div class="privacy-detail" id="privacyDetail">
              <strong>수집항목:</strong> 이름, 이메일, 연락처<br>
              <strong>수집목적:</strong> 크루즈 상담 및 예약 안내<br>
              <strong>보유기간:</strong> 상담 완료 후 1년<br><br>
              위 개인정보 수집·이용에 동의하지 않을 수 있으며, 동의하지 않을 경우 문의 접수가 불가합니다.
            </div>
          </div>
          <button type="submit" class="btn btn-orange" id="submitBtn" style="width:100%;margin-top:16px;padding:14px;font-size:1.05rem">문의하기 전송</button>
        </form>
      </div>
    </div>
  </div>
</body>
</html>
